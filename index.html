<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kiara 4U — Neon Player</title>

<style>
:root {
  --bg-duration: 2.5s;
  --ring-blur: 10px;
}

.cc_streaminfo { display: none !important; }

html,body {
  height:100%;margin:0;
}
body {
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(135deg,#140028,#2b0040);
  color:#fff;
  transition: background var(--bg-duration) ease;
}

.card {
  width: 92%;
  max-width: 420px;
  background: rgba(255,255,255,0.04);
  padding: 20px;
  border-radius: 16px;
  text-align:center;
  box-shadow: 0 12px 30px rgba(0,0,0,0.6);
}

.cover-wrap {
  position: relative;
  width: 260px;
  height: 260px;
  margin: 0 auto 14px;
  border-radius: 50%;
  display:grid;
  place-items:center;
}

.ring {
  position:absolute;
  inset: -8px;
  border-radius:50%;
  background: conic-gradient(from 120deg,#00bfff,#ff00cc,#7a00ff,#00bfff);
  filter: blur(var(--ring-blur));
  z-index: 0;
  animation: spin 18s linear infinite, pulse 1.4s ease-in-out infinite alternate;
  transform: scale(1);
  transition: transform .45s ease;
}

@keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
@keyframes pulse { from{transform:scale(.985)} to{transform:scale(1.02)} }

img#cover {
  width: 86%;
  height: 86%;
  object-fit: cover;
  border-radius: 18px;
  z-index: 2;
  box-shadow: 0 12px 30px rgba(0,0,0,0.6);
  opacity: 0;
  transform: scale(.98);
  transition: opacity .45s ease, transform .45s ease;
  background: linear-gradient(180deg,#111,#222);
}
img#cover.visible { opacity: 1; transform: scale(1); }

h1 { font-size: 1.25rem; margin: 10px 0 4px; opacity: 0.97; }
h2 { font-size: 1rem; margin: 0 0 10px; color: rgba(255,255,255,0.86); font-weight:500; }

.controls {
  margin-top:15px;
  display:flex;
  gap:14px;
  justify-content:center;
}
.btn {
  background:#fff;
  border:none;
  border-radius:50%;
  width:50px;
  height:50px;
  font-size:18px;
  cursor:pointer;
  color:#000;
  box-shadow:0 0 12px rgba(255,255,255,0.2);
  transition:all .3s;
}
.btn:hover{
  background:#ff00cc;
  color:#fff;
  box-shadow:0 0 15px #ff00cc,0 0 25px #ff00cc;
  transform:scale(1.1);
}

footer { margin-top:12px; font-size:12px; color:rgba(255,255,255,0.6); }

@media (max-width:420px){
  .cover-wrap{width:72vw;height:72vw}
  img#cover{border-radius:14px}
}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Kiara 4U Player">
    <div class="cover-wrap">
      <div class="ring" id="ring"></div>
      <img id="cover" src="http://cdn.theradiohub.com/logos/157.jpg" alt="Cover lagu">
    </div>

    <h1 id="title">Memuat lagu...</h1>
    <h2 id="artist">Kiara 4U</h2>

    <audio id="audio" preload="none" crossorigin="anonymous">
      <source src="https://eu1.fastcast4u.com/proxy/kiarafm?mp=/1" type="audio/mpeg">
      Browser Anda tidak mendukung audio.
    </audio>

    <div class="controls">
      <button id="play" class="btn" aria-label="Play">▶</button>
      <button id="stop" class="btn" aria-label="Stop">⏹</button>
      <button id="refresh" class="btn" aria-label="Refresh metadata">⟳</button>
    </div>

    <footer>© Kiara 4U Radio</footer>
  </div>

  <span class="cc_streaminfo" data-type="song" data-username="kiarafm" style="display:none;">Loading...</span>
  <script src="https://eu1.fastcast4u.com/system/streaminfo.js"></script>

<script>
const POLL_MS = 7000;
const ITUNES_TIMEOUT = 3000;
const DEEZER_TIMEOUT = 3000;

const coverEl = document.getElementById('cover');
const titleEl = document.getElementById('title');
const artistEl = document.getElementById('artist');
const ringEl = document.getElementById('ring');
const audio = document.getElementById('audio');
const playBtn = document.getElementById('play');
const stopBtn = document.getElementById('stop');
const refreshBtn = document.getElementById('refresh');

let lastKey = '';
const cache = new Map();

playBtn.onclick = () => {
  if(audio.paused){ audio.play().catch(()=>{}); playBtn.textContent='⏸'; }
  else { audio.pause(); playBtn.textContent='▶'; }
};
stopBtn.onclick = () => { audio.pause(); audio.currentTime = 0; playBtn.textContent='▶'; };
refreshBtn.onclick = () => fetchNowPlaying(true);

function readFastcast(){
  const el = document.querySelector('.cc_streaminfo[data-username="kiarafm"]');
  return el ? el.textContent.trim() : '';
}
function normalize(s){
  return (s||'').toLowerCase().replace(/\([^)]*\)/g,'').replace(/feat\.?/g,'')
    .replace(/ft\.?/g,'').replace(/["“”'‘’]/g,'').replace(/[^\w\s]/g,'')
    .replace(/\s+/g,' ').trim();
}
function fetchTimeout(url, timeout=3000){
  return Promise.race([
    fetch(url,{cache:'no-store'}).then(r=>r.ok?r.json():Promise.reject()),
    new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),timeout))
  ]);
}
async function lookupDeezer(artist, title){
  const q = encodeURIComponent(`${artist} ${title}`);
  try{
    const data = await fetchTimeout(`https://api.deezer.com/search?q=${q}&limit=3`,DEEZER_TIMEOUT);
    if(!data || !data.data) return null;
    for(const item of data.data){
      const cover = item.album?.cover_big || item.album?.cover_medium;
      if(cover) return {cover,source:'deezer'};
    }
  }catch{return null;}
  return null;
}
async function lookupItunes(artist, title){
  const q = encodeURIComponent(`${artist} ${title}`);
  try{
    const data = await fetchTimeout(`https://itunes.apple.com/search?term=${q}&entity=song&limit=3`,ITUNES_TIMEOUT);
    if(!data.results) return null;
    const r=data.results[0];
    return {cover:r.artworkUrl100?.replace('100x100','600x600'),source:'itunes'};
  }catch{return null;}
}
async function findCoverParallel(artist,title){
  const [d,i]=await Promise.allSettled([lookupDeezer(artist,title),lookupItunes(artist,title)]);
  if(d.status==='fulfilled' && d.value && d.value.cover) return d.value;
  if(i.status==='fulfilled' && i.value && i.value.cover) return i.value;
  return null;
}
function applyCover(artist,title,coverUrl){
  ringEl.style.transform='scale(1.06)';
  clearTimeout(ringEl._rt);
  ringEl._rt=setTimeout(()=>ringEl.style.transform='scale(1)',600);
  titleEl.textContent=title||'Sedang bermain...';
  artistEl.textContent=artist||'Kiara 4U';
  if(coverEl.src===coverUrl){coverEl.classList.add('visible');return;}
  coverEl.classList.remove('visible');
  setTimeout(()=>{
    coverEl.src=coverUrl||'http://cdn.theradiohub.com/logos/157.jpg';
    coverEl.onerror=()=>{coverEl.src='http://cdn.theradiohub.com/logos/157.jpg';coverEl.classList.add('visible');};
    coverEl.onload=()=>coverEl.classList.add('visible');
  },140);
}
async function fetchNowPlaying(force=false){
  try{
    const raw=readFastcast();
    if(!raw)return;
    let artist='Kiara 4U',title='Sedang bermain...';
    if(raw.includes(' - ')){
      const p=raw.split(' - ');
      artist=p[0].trim();title=p.slice(1).join(' - ').trim();
    }else if(raw.trim()){title=raw.trim();}
    const key=(artist+' - '+title).trim();
    if(!force && key===lastKey)return;
    lastKey=key;
    titleEl.textContent=title;artistEl.textContent=artist;
    if(cache.has(key)){applyCover(artist,title,cache.get(key).cover);return;}
    const found=await findCoverParallel(artist,title);
    const coverUrl=(found&&found.cover)||'http://cdn.theradiohub.com/logos/157.jpg';
    cache.set(key,{cover:coverUrl});
    applyCover(artist,title,coverUrl);
  }catch(e){console.warn(e);}
}
fetchNowPlaying(true);
setInterval(fetchNowPlaying,POLL_MS);
const bgList=[
  'linear-gradient(135deg,#0b0830,#22002b)',
  'linear-gradient(135deg,#001028,#230035)',
  'linear-gradient(135deg,#1b0034,#090014)'
];
let bgIdx=0;
setInterval(()=>{bgIdx=(bgIdx+1)%bgList.length;document.body.style.background=bgList[bgIdx];},14000);
</script>
</body>
</html>
